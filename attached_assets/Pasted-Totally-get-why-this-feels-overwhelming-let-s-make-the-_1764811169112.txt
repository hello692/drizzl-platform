Totally get why this feels overwhelming — let’s make the agent behave like a real senior engineer and *finish* the whole system instead of dropping random half-features.

Here’s a **single prompt** you can paste into the Replit agent.
(You don’t need to edit it; it already assumes Drizzl, Supabase, e-commerce store, B2B & admin dashboards.)

---

You are a **senior principal full-stack engineer** working on the **Drizzl** SaaS platform in this Replit project.

The project already has:

* A **public e-commerce store** (for normal D2C customers),
* A **B2B / Retail Partner Portal** for wholesale customers,
* An **Admin “Command Center” dashboard** (dark UI with modules: Orders, Products, Inventory, Factory, Partners, Banking, Analytics, AI Assistant, etc.),
* Supabase (Postgres + Auth) as backend.

Right now things are **half-connected**: dashboards don’t know who is logged in, auth roles are not wired, many buttons navigate nowhere or show dummy data, and the B2B approval flow is incomplete.

Your job is to **turn this into a fully working, connected SaaS** with a single source of truth and no dead ends.

---

## GLOBAL REQUIREMENTS

1. **Do not delete or break existing pages/styles.** Improve and connect them.
2. Use **Supabase** as the canonical backend:

   * Auth
   * Profiles & roles
   * Orders, products, inventory, partners, etc.
3. Minimize “stub” components. If a feature is not built yet, show a clear “Coming soon” message instead of a broken or empty screen.
4. Add **clear error and loading states** for every API call.
5. At the end, print a concise **implementation report** listing:

   * Tables created / changed
   * New routes/pages
   * How to log in as each role
   * How the dashboards are wired.

---

## STEP 0 – SCAN & UNDERSTAND

1. Scan the entire repo:

   * Detect the framework (Next.js / React, routing style, API routes, etc.).
   * Find existing Supabase client, auth provider, and current tables used.
   * Locate:

     * Public storefront pages (shop, product detail, checkout).
     * Any existing “Retail Partner / Wholesale Application” components.
     * Admin Command Center dashboard (the one with modules cards).
     * Any existing “customer” or “b2b” dashboards, even if incomplete.
2. Summarize the current architecture in comments at the top of a new file: `docs/ARCHITECTURE-NOTES.md` (or similar).

---

## STEP 1 – UNIFIED AUTH, PROFILES & ROLES

Create/ensure a **single auth + profile system**:

### Tables

In Supabase, ensure these tables exist (migrate if needed):

**`profiles`**

* `id` (uuid PK = `auth.users.id`)
* `full_name`
* `email`
* `phone`
* `account_type` (`'customer' | 'b2b'`)
* `role` (`'customer' | 'b2b' | 'admin'`) — default `'customer'`
* `b2b_status` (`'none' | 'pending' | 'approved' | 'rejected'`) — default `'none'`
* `created_at`, `updated_at`

**`wholesale_applications`**

* `id` (uuid PK)
* `user_id` (uuid FK → `auth.users.id`)
* `company_name`
* `contact_name`
* `email`
* `phone`
* `estimated_monthly_order_volume`
* `preferred_delivery_schedule`
* `receiving_hours`
* `loading_dock_available`
* `notes` (text)
* `status` (`'pending' | 'approved' | 'rejected'`) – default `'pending'`
* `reviewed_by` (uuid, nullable)
* `reviewed_at` (timestamp, nullable)
* `created_at`, `updated_at`

Apply Supabase-style RLS:

* Users can see/update only their own `profiles` and their own `wholesale_applications`.
* Admins can see everything.

### Auth UI & Flow

1. Create **one sign-up page** with a toggle:

   * “Customer Account”
   * “Retail / B2B Partner Account”
2. On sign-up:

   * Create Supabase auth user.
   * Insert into `profiles`:

     * `account_type` per selection.
     * For B2B: set `b2b_status = 'pending'`.
3. For B2B sign-up:

   * Immediately show/collect the **Retail Partner Application** (company, est. volume, etc.) and save it in `wholesale_applications`.
4. Create a **single login page**; after login, redirect based on role:

   * `role = 'admin'` → Admin Command Center.
   * `account_type = 'b2b'` → B2B dashboard.
   * `account_type = 'customer'` → Customer dashboard / orders page.

Implement a reusable hook or context (e.g. `useCurrentUser()`) that returns user + profile + role so every dashboard can rely on it.

---

## STEP 2 – DASHBOARDS ROUTING & ACCESS CONTROL

### 2.1 Customer Dashboard

Create or fix route (e.g. `/dashboard`):

* Shows:

  * Recent orders (from `orders` table).
  * Order status.
  * Profile summary.
* Protect this route: only logged-in users with `role = 'customer'` OR `account_type = 'customer'`.

### 2.2 B2B Dashboard

Route example: `/b2b/dashboard`.

* If `b2b_status = 'pending'`:

  * Show their application data and “Application Under Review” card.
* If `b2b_status = 'approved'`:

  * Show wholesale catalog, B2B orders (filtered by `user_id` and `order_type='b2b'`).
  * Add entry point to place B2B orders (even if simple).
* If `b2b_status = 'rejected'`:

  * Show polite rejection message and support contact.

### 2.3 Admin Dashboard (Command Center)

Use the existing dark UI as **Admin only** route, e.g. `/admin`.

* Enforce access: only `profiles.role = 'admin'`.
* Top-level cards:

  * **Total Orders**, **Revenue**, **D2C Orders**, **B2B Orders** — real data from `orders`.
* Each module card in “Intelligence Modules” must:

  * Navigate to a real route (e.g. `/admin/orders`, `/admin/products`, `/admin/inventory`, `/admin/partners`, `/admin/banking`, etc.).
  * On each route, show at least a functional basic table or “Coming soon” message — never a dead link or blank screen.

---

## STEP 3 – CORE DATA MODELS (ORDERS, PRODUCTS, ETC.)

Standardize on Supabase tables:

**`products`**

* id, name, SKU, price, type (`'d2c' | 'b2b' | 'both'`), etc.

**`orders`**

* `id` (uuid)
* `user_id`
* `order_type` (`'d2c' | 'b2b'`)
* `status` (`'pending' | 'paid' | 'shipped' | 'completed' | 'cancelled'`)
* `total_amount`
* `created_at`, `updated_at`

**`order_items`**

* `id`
* `order_id`
* `product_id`
* `quantity`
* `unit_price`

Wire **public e-commerce store** so that:

* Adding to cart → creates local cart client-side.
* Checkout completion → inserts row in `orders` + `order_items` with `order_type='d2c'`.
* If Stripe or similar is configured, use existing integration; otherwise, simulate success with a placeholder “Payment successful” page and mark order `paid`.

For **B2B ordering**:

* B2B dashboard can place an order (simpler form is okay) and inserts `order_type='b2b'`.

Ensure Admin Orders (`/admin/orders`) shows all orders with filters:

* D2C vs B2B
* By status.

---

## STEP 4 – B2B APPROVAL & NOTIFICATIONS

Hook the **Retail Partner Application** into Admin:

1. Create `/admin/partners` (or `/admin/b2b`) page:

   * Table of all `wholesale_applications` joined with `profiles`.
   * Filters: Pending / Approved / Rejected.
2. Row click → drawer/modal with full application details and actions:

   * Approve
   * Reject
   * Optional note.
3. **Approve:**

   * `wholesale_applications.status = 'approved'`
   * `profiles.b2b_status = 'approved'`
   * `profiles.account_type` stays `'b2b'`
   * Optionally set `role = 'b2b'` if using role-based gating.
4. **Reject:**

   * Set corresponding statuses to `'rejected'`.

### Notifications

Create helper utilities (or use existing):

* `sendEmail(to, subject, htmlText)`
* `sendSMS(toPhone, message)`

On submission:

* Send **“Application received”** email + SMS.

On approval:

* Send **“Account approved”** email + SMS with login link and instructions.

On rejection:

* Send polite rejection.

Use environment variables for keys (Resend/SendGrid/Twilio). If these services are not configured, at least log the “would send email/SMS” messages to the console to avoid runtime errors.

---

## STEP 5 – WIRE ALL ADMIN MODULE CARDS

For each card on the Command Center dashboard:

* **Command Center** → main `/admin` overview (already there).
* **AI Assistant** → `/admin/ai-assistant` (simple page with text area calling existing AI API if present or placeholder).
* **Product Intel** → `/admin/product-intel` showing products table and basic stats.
* **Inventory** → `/admin/inventory` showing stock levels (or skeleton “Connect inventory” instructions).
* **Factory** → `/admin/factory` (production batches or coming soon).
* **Order Intel** → `/admin/order-intel` (charts or at least aggregated numbers on orders).
* **Video Manager** → `/admin/videos` (or coming soon).
* **Social Media** → `/admin/social` (or coming soon).
* **Banking** → `/admin/banking` (show revenue numbers from `orders.total_amount`).
* **Orders** → `/admin/orders` full table.
* **Partners** → `/admin/partners` (B2B applications / partners list).
* **Products** → `/admin/products` manage product catalog (CRUD).

Every button must either:

* Navigate to a working page with real data, **or**
* Navigate to a page that clearly says “Feature coming soon” and doesn’t throw errors.

---

## STEP 6 – CLEANUP & CONSISTENCY

1. Remove unused old auth wrappers, duplicate context providers, or obsolete test pages that conflict with new flows.
2. Ensure navigation bars (top/side) respect roles:

   * Customers should not see Admin or B2B links.
   * B2B users see their B2B menu.
   * Admin sees everything.
3. Make sure logout works everywhere and clears session.

---

## STEP 7 – FINAL REPORT

When you finish coding:

1. Output a clear summary in the Replit console / final message including:

   * **Tables & migrations** added/modified.
   * **New routes** for:

     * Customer dashboard
     * B2B dashboard
     * Admin dashboard & sub-pages
   * How to:

     * Create an admin user (manual Supabase update instructions if needed).
     * Sign up as customer and B2B user.
     * Test the whole flow: sign up → order → admin view → B2B approval → B2B ordering.

Goal: After your changes, Drizzl is a **coherent, fully wired platform**:

* One auth system.
* Three clear experiences (Customer, B2B, Admin).
* Orders & products shared across all.
* No dead buttons, no random disconnected modules.

Now scan the repo and implement all of the above step by step.

---

Copy everything between the lines into the Replit agent.
