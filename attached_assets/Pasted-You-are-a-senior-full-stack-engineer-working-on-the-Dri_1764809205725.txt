You are a senior full-stack engineer working on the Drizzl Retail Partner Portal in this Replit project (Next.js/React + Supabase).

The portal ALREADY allows users to submit a Retail / Wholesale Partner Application and then shows “account is being reviewed”.

Your job now is to build a complete B2B approval + notifications system and wire it into the existing Admin dashboard (the dark “Command Center” UI).

1. Data model (Supabase)

Make sure Supabase has the following tables/columns (create or migrate as needed):

profiles

id (uuid, PK, = auth.users.id)

full_name

email

phone

account_type ('personal' | 'b2b')

b2b_status ('none' | 'pending' | 'approved' | 'rejected')

role ('customer' | 'b2b' | 'admin') — default 'customer'

created_at, updated_at

wholesale_applications

id (uuid, PK, default uuid_generate_v4())

user_id (uuid, FK → auth.users.id)

company_name

contact_name

email

phone

estimated_monthly_order_volume

preferred_delivery_schedule

receiving_hours

loading_dock_available

notes (text)

status ('pending' | 'approved' | 'rejected')

created_at, updated_at

Optional: reviewed_by (admin id), reviewed_at

Keep RLS compatible (standard Supabase pattern: users can only see their own row; admins can see all).

2. Submitting a Retail Partner / Wholesale Application

When a user signs up as a Retail Partner / Wholesale and completes the application:

Ensure there is an authenticated Supabase user.

Create or update profiles row:

account_type = 'b2b'

b2b_status = 'pending'

Create a row in wholesale_applications linked via user_id with status = 'pending'.

In the user’s portal (their dashboard), show:

“Your Retail Partner application is under review” with key details.

Send notifications immediately:

Email to the applicant:
“Thank you for applying to the Drizzl Retail Partner Portal. Your application is being reviewed. We’ll email you once it’s approved or declined.”

SMS with a short version of the same message.

Use whatever email/SMS integrations are already configured in the project (e.g., Resend/SendGrid + Twilio). If none exist, create simple helpers and read API keys from environment variables (RESEND_API_KEY, TWILIO_SID, etc.) and call them from an API route or server action.

3. Admin: View & Review All Applicants

In the existing Admin Command Center dashboard:

Add a new module / page: “Retail Partners” or “Wholesale Applications”.

This page should:

List all applications from wholesale_applications joined with profiles.

Default filter: status = 'pending', with tabs or filters for Pending / Approved / Rejected.

Columns: Company, Contact, Email, Phone, Est. Volume, Submitted At, Status, Actions.

Clicking a row opens a detail view (drawer or modal) with full application info and controls:

Approve

Reject

Optional text area for internal notes (stored in notes).

Only users whose profiles.role = 'admin' can access this page. Add middleware / server-side guard for /admin routes.

4. Approve / Reject Flow
4.1 Approve

When an admin clicks Approve on an application:

Update wholesale_applications.status = 'approved'.

Update profiles for that user:

b2b_status = 'approved'

role = 'b2b' (or keep role separate and just rely on b2b_status—but ensure the app knows they now have B2B access).

Temporary password logic:

If the applicant ALREADY has a Supabase auth account (normal case):

Do not change their password; instead, send them a login link.

If the account was created by admin without a login (edge case):

Generate a secure random password (e.g. 16 chars).

Create the Supabase Auth user (if not present) with that temp password.

Store a flag like must_reset_password if needed.

Send approval email + SMS with:

Subject: “Your Drizzl Retail Partner account has been approved”

Message includes:

Confirmation of approval

Login URL to the Retail Partner Portal

If a temp password was generated, include:
Email: {their email}
Temporary Password: {tempPassword}
and instructions to log in and change password.

On the applicant side, when they log in, their dashboard should:

Show Retail Partner approved.

Unlock B2B sections (wholesale prices, B2B orders, etc. — just toggle whatever feature flags already exist).

4.2 Reject

When an admin clicks Reject:

Update wholesale_applications.status = 'rejected'.

Update profiles.b2b_status = 'rejected'.

Send email + SMS:

Polite rejection text, optionally with a reason or next steps.

Applicant dashboard should show:
“Your Retail Partner application was not approved at this time” with the status.

5. User Dashboard Status

For a logged-in user with account_type = 'b2b':

If b2b_status = 'pending': show a big card “Application under review.”

If b2b_status = 'approved': show access to B2B Orders, wholesale pricing, etc.

If b2b_status = 'rejected': show a clear status and support contact link.

This logic should be implemented in the dashboard page (whatever route currently shows the dark “Dashboard / Intelligence Modules” view).

6. Implementation Notes

Don’t break existing D2C flows or styling.

Keep all new code modular: helpers for sendEmail, sendSMS, and updateApplicationStatus.

Add clear comments in new files and a short summary in the README or in a code comment at the top of the main admin page explaining:

Where the admin applications page lives.

How status changes trigger email/SMS notifications.

Start by scanning the repo to locate:

The Retail Partner / wholesale application components and API routes.

The Admin dashboard layout.
Then implement the data model changes, then the submission → pending flow, then the admin review + approve/reject + notifications.